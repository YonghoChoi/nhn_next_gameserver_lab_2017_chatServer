게임서버 과정 수업에 사용할 채팅 서버.  


### 사양
- Windows 플랫폼만 지원(Linux 지원 어렵지 않음)
- 64비트 지원
- C++ 로 구현
- Visual Studio 2017
- select 기반
- 동기 IO
- DB 연동은 구현 되지 않음.
- 로비 채팅, 방 채팅 구현

**학습용으로 만든 것으로 버그와 비효율적인 코드가 있을 수 있다**



## 실행 환경

- [nana 다운로드](http://nanapro.org/en-us/)

- 압축 해제 후 nana/build/vc2017 위치에서 nana 프로젝트 실행

- 프로젝트 속성 > C/C++ > 코드 생성 > 런타임 라이브러리 수정

  - 다중 스레드 디버그 DLL(/MDd)

- 프로젝트 속성 > 일반 > Windows SDK 버전을 현재 버전에 맞춤

- 메뉴 > 빌드 > 일괄 빌드

  - 64비트 릴리즈, 디버그 만 선택 후 빌드 실행

- 채팅 서버 클론

  ```
  git clone https://github.com/jacking75/nhn_next_gameserver_lab_2017_chatServer.git
  ```

- vc2017로 실행 후 포함 디렉토리와 라이브러리 디렉토리 경로 설정

  - VC++ 디렉터리 > 포함 디렉터리 : nana/include
  - VC++ 디렉터리 > 라이브러리 디렉터리 : nana/build/bin

## 패킷 분할

- 내부 서버간 통신에서는 MTU 크기를 조절 가능하므로 점보 프레임(9000 byte)을 사용해야함.
- MSS(MTU에서 헤더 크기를 뺀 크기) 크기를 고려해서 패킷을 작성해야함.
- 패킷 분할은 네트워크에 맡기지 않고 직접하는 것이 좋음
  - 자동 분할에 맡기면 도중에 하나만 실패하더라도 다시 처음부터 전송
  - 모바일의 경우 이 현상이 나타나기 더 쉬움
    - 연결이 자주 끊어져서
- TCP는 뭉쳐서 보내지만 UDP는 건바이건으로 보냄
  - UDP는 연결 지향이 아니라서 모아보내기가 애매함
- 서버 구동 시에는 받을 수 있는 최대 유저수를 반드시 설정해야함
  - 안하면 서버 죽음
- consoleHost 프로젝트 열어서 TCPNetwork를 직접 따라해보면서 이해하기
  - 코드에 주석 달기
  - 주석 보고 코드 짜기
- TCP의 경우에는 커널 단에서는 패킷의 순서보장이 되지 않기 때문에 버퍼를 만들고 순서를 맞추는 작업이 들어가지만 어플리케이션 단에서는 이미 커널에서 순서를 맞췄기 때문에 순서보장이 된 상태로 전달됨.
  - 개발자는 순서대로 온다고 생각하고 로직을 구현하면 됨
- OS 커널 레벨에서 하트비트 체크와 유사하게 keep alive 기능이 있지만 기본 설정 값이 몇 십분 단위로 길기 때문에 이를 활용하는 것은 별로 좋지 않음. 그리고 커널 설정이라서 이 설정을 바꾸면 해당 머신의 모든 어플리케이션에 영향이 가기 때문에 다른 문제가 발생할 수 있음.
  - keep alive 설정을 너무 짧게 잡으면 모든 클라이언트에 대해 확인 패킷을 자주 보내게 되기 때문에 성능에 좋지 않음.
  - 하트비트를 직접 구현하는 것이 제일 좋음.
- 봐야할 부분들
  - LogicLib
    - Game.cpp 제외하고 살펴보면 될 듯.
      - 구현이 안되어 있음.